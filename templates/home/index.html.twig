{% extends 'base.html.twig' %}

{% block title %}Home{% endblock %}

{% block body %}

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            console.log('Document ready');

            // Initialisation : Cache le formulaire
            var createCardFormContainer = document.querySelector('#createCardFormContainer');
            createCardFormContainer.style.display = 'none';

            // Charge le formulaire de création de carte en AJAX
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '{{ path('create_cards') }}', true);
            console.log('Formulaire preprechargé');
            xhr.onload = function() {
                console.log('Formulaire prechargé');
                if (xhr.status === 200) {
                    console.log('Formulaire chargé');
                    createCardFormContainer.innerHTML = xhr.responseText;

                    // Ajoute un gestionnaire d'événement pour le clic sur le bouton après le chargement AJAX
                    document.querySelector('#toggleCreateCardForm').addEventListener('click', function() {
                        createCardFormContainer.style.display = 'block';
                        let modalcreate = document.getElementById('createCardFormContainer');
                        let modaldetails = document.getElementById('details');
                        console.log('animation');
                        setTimeout(function() {
                        modalcreate.style.transform = 'translateX(-100%)';
                        modalcreate.style.transition = 'transform 0.5s ease-in-out';
                        modaldetails.style.transform = 'translateX(0)';
                        }, 100);

                        let backBtn = document.getElementById('create-back');
                        if (backBtn) {
                            backBtn.addEventListener('click', function() {
                                modalcreate.style.transform = 'translateX(0)';
                            });
                        }
                    });

                        /*var items = document.querySelector('.items');
                        if (items) {
                            items.style.display = (items.style.display === 'none') ? 'block' : 'none';
                        }

                        var sideListTitle = document.querySelector('#side-list_title');
                        if (sideListTitle) {
                            sideListTitle.style.display = (sideListTitle.style.display === 'none') ? 'block' : 'none';
                        }*/



                    // Ajoute un gestionnaire d'événement pour le changement sur cards_crd_typ après le chargement AJAX
                    document.getElementById('cards_crd_typ').addEventListener('change', function() {
                        var selectedValue = this.value;
                        console.log(selectedValue);

                        // Masquer ou afficher les champs crd_sbj et crd_from en fonction du choix
                        var labelCrdSbj = document.getElementById('label_crd_sbj');
                        var labelCrdFrom = document.getElementById('label_crd_from');

                        if (selectedValue === '1' || selectedValue === '2') {
                            labelCrdSbj.style.display = 'block';
                            labelCrdFrom.style.display = 'none';
                        } else if (selectedValue === '3' || selectedValue === '4') {
                            labelCrdFrom.style.display = 'block';
                            labelCrdSbj.style.display = 'none';
                        } else {
                            // Afficher les deux champs ou effectuer d'autres actions si nécessaire
                            labelCrdSbj.style.display = 'none';
                            labelCrdFrom.style.display = 'none';
                        }
                    });
                }
            }
            xhr.send();

        });


    </script>



    {% include 'components/header.html.twig' %}
    <button id="toggleCreateCardForm">Créer une carte</button>
    <main class="main">
        <div id="calendar" data-url="{{ path('app_calendar_data') }}"></div>
        <div id="section-right">

            <div class="side-list">

                <div id="side-list_title">
                    <h2>À Venir</h2>
                </div>
                <div class="items">
                    {% for item in cardData %}
                        <div class="item {% if item.card.getIsValidated == 0 %} notvalidated {% endif %}"
                             style="border-left-color: {{ item.typeColor }} !important;">
                            <p class="card-id">{{item.card.getId}}</p>
                            <p class="type-id">{{item.card.getCrdTyp.getId}}</p>
                            <div class="time">
                                <p class="date">
                                    {% if item.card.getCrdFrom is not null %}
                                        Du {{ item.card.getFormattedCrdFrom }} <br>Au
                                    {% endif %}
                                    {{ item.card.getFormattedCrdTo }}
                                </p>
                                <div class="time_left">
                                    <i class="fa-solid fa-hourglass-half" style="color:{{ item.timeColor }}"></i>
                                    <p class="days">{{ item.card.getTimeLeft|raw }}</p>
                                </div>
                            </div>
                            <div class="subject">
                                <p class="tag"
                                   style="border-color: {{ item.typeColor }}; background-color: {{ item.typeColor }}20">{{ item.typeName }}</p>
                                <div>
                                    <h3 class="notif-card__title">{{ item.card.getCrdTitle }}</h3>
                                    <p class="notif-card__subject">{{ item.subjectRef }} - {{ item.subjectName }}</p>
                                </div>
                            </div>
                            {% if item.typeName is same as('rendu') %}
                                <!--<div class="status">
                                    <i class="fa-regular fa-square"></i>
                                    <p>À Rendre</p>
                                </div>-->
                                <div class="status status-button not-done">
                                    <i class="fa-regular fa-square not-done"></i>
                                    <i class="fa-regular fa-square done"></i>
                                    <p>Rendu</p>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div id="createCardFormContainer" class="details"></div>

            <div id="details" class="details">
            </div>
        </div>
    </main>
{% endblock %}
